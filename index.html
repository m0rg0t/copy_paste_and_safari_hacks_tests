<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ‰</text></svg>"
    />
    <title>How to paste images and text (even in Safari)</title>
  </head>
  <body>
    <style>
      :root {
        color-scheme: dark light;
      }

      html {
        box-sizing: border-box;
      }

      *,
      *:before,
      *:after {
        box-sizing: inherit;
      }

      body {
        margin: 1rem;
        font-family: system-ui, sans-serif;
      }

      button {
        display: block;
      }
    </style>
    <h1>How to paste images</h1>
    <p>
      Hit <kbd>âŒ˜</kbd> + <kbd>v</kbd> (for macOS) or <kbd>ctrl</kbd> +
      <kbd>v</kbd>
      (for other operating systems) to paste images anywhere in this page.
    </p>
    <hr />
    <form>
        <h2>Form to test input focuses for safari</h2>
        <input type="text" placeholder="regular text input" />
        <input type="text" id="superfocus" placeholder="superfocus" autofocus />
    </form>
    <hr />


    <script>
        const superFocusInput = document.getElementById('superfocus');

        superFocusInput.addEventListener('blur', (e) => {
            console.log('blur', e);
            e.target.focus(); //return focus to the input
        });

        document.addEventListener("paste", async (e) => {
          console.log("Pasting...");
          e.preventDefault();
          const clipboardItems =
            typeof navigator?.clipboard?.read === "function"
              ? await navigator.clipboard.read()
              : e.clipboardData.files;
  
              console.log("clipboardItems", clipboardItems);
  
          for (const clipboardItem of clipboardItems) {
            let blob;
            if (clipboardItem.type?.startsWith("image/")) {
              // For files from `e.clipboardData.files`.
              blob = clipboardItem;
              // Do something with the blob.
              appendImage(blob);
              return;
            } else {
              // For files from `navigator.clipboard.read()`.
              const imageTypes = clipboardItem.types?.filter((type) =>
                type.startsWith("image/")
              );
              for (const imageType of imageTypes) {
                blob = await clipboardItem.getType(imageType);
                // Do something with the blob.
                appendImage(blob);
                return;
              }
            }
  
            try {
              //get texts from clipboard
              const textBlob = await clipboardItem.getType("text/plain");
              const text = await textBlob.text();
              appendText(text);
            } catch (ex) {
              console.error(ex);
            }
          }
        });
  
        const appendText = (text) => {
          const p = document.createElement("p");
          p.textContent = text;
          document.body.append(p);
        };
  
        const appendImage = (blob) => {
          const img = document.createElement("img");
          img.src = URL.createObjectURL(blob);
          document.body.append(img);
        };
      </script>
  </body>
</html>
